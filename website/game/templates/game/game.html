{% extends "base/base.html" %}
{% load static %}

{% block title %}Game Board - 226 Game{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'game-styles.css' %}">
{% endblock %}

{% block header %}226 Game{% endblock %}

{% block content %}
            <!-- Game Form. Just surrond the whole game board with a form to allow for post requests -->
            <form action="{% url 'pick_action' %}" method="post" class="game-form">
                {% csrf_token %}
                
                <!-- Control Bar -->
                <div class="control-bar">
                    <div>
                        <label for="current-player">Player:</label>
                        <select id="current-player" name="player_name">
                            <!-- Player List in the select element -->
                            {% for player in player_list %}
                                <option value="{{ player.name }}" style="color: {{ player.color }}">{{ player.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <!-- New Game Button -->
                    <a href="{% url 'reset_game' %}" class="btn">New Game</a>
                </div>

                <!-- Game Layout -->
                <div class="game-layout">
                    <!-- Scoreboard -->
                    <div class="panel scoreboard-panel">
                        <h3>Scores</h3>
                        <!-- Player List in the scoreboard panel -->
                        {% for player in player_list %}
                            <div class="score-item">
                                <span style="color: {{ player.color }}">{{ player.name }}</span>
                                <span class="score-val">{{ player.score }}</span>
                            </div>
                        {% endfor %}
                    </div>

                    <!-- Board -->
                    <div class="panel board-panel">
                        <div class="game-message">
                            <p>{{ game_message }}</p>
                        </div>
                        <div class="board-wrapper">
                            <!-- Board Table -->
                            {% if board %}
                                <table class="board">
                                    <tr>
                                        <td class="coord-corner"></td>
                                        <!-- Column Headers -->
                                        {% for col in board %}
                                            <!-- For loop counter just for the coordinate header -->
                                            <td class="coord-header">{{ forloop.counter0 }}</td>
                                        {% endfor %}
                                    </tr>
                                    <!-- Row Headers -->
                                    {% for row in board %}
                                        <tr>
                                            <!-- For loop counter just for the coordinate header -->
                                            <td class="coord-header">{{ forloop.counter0 }}</td>
                                            <!-- Tile List -->
                                            {% for tile in row %}
                                                <td>
                                                    <!-- I'll want to probably change the submit button, and will want to  -->
                                                    <button 
                                                        type="submit"  
                                                        name="tile" 
                                                        value="{{ tile.row }},{{ tile.col }}" 
                                                        class="tile tile-btn 
                                                        {% if tile.value == PICKED_TILE %}
                                                            picked
                                                        {% endif %}
                                                        {% if tile.value != DEFAULT_TILE and tile.value != PICKED_TILE %}
                                                            treasure
                                                        {% endif %}"
                                                        {% if tile.picked_by %}
                                                            style="background: {{ tile.picked_by.color }}; opacity: 0.7; color: white;"
                                                        {% endif %}>
                                                        {{ tile.value }}
                                                    </button>
                                                </td>
                                            {% endfor %}
                                        </tr>
                                    {% endfor %}
                                </table>
                            {% else %}
                            <!-- No Board Active -->
                                <div class="text-center">
                                    <p>No board active.</p>
                                    <a href="{% url 'create' %}" class="btn mt-2">Create Board</a>
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Instructions -->
                    <div class="panel instructions-panel">
                        <h3>How to Play</h3>
                        <div class="instructions">
                            <ul>
                                <li>Click tiles to find treasure.</li>
                                <li>Numbers = Points.</li>
                                <li>{{ PICKED_TILE }} = Already checked.</li>
                                <li>High score wins!</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </form>
{% endblock %}


