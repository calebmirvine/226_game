{% extends "base/base.html" %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'game-styles.css' %}">
{% endblock %}

{% block title %}Choose Initial Players{% endblock %}
{% block header %}Choose Initial Players{% endblock %}
{% block content %}
    <div class="panel setup-panel">
        <h2 class="mb-4">New Game Setup</h2>
        
        <form action="{% url 'lobby' %}" method="post">
            {% csrf_token %}
            
            <div class="color-picker-section">
                <label>Choose Your Color:</label>
                <input type="color" name="color" id="color" value="{{ form.color.value }}">
            </div>

            <div id="player-slots" 
                 class="player-slots"
                 hx-get="." 
                 hx-trigger="every 7s" 
                 hx-select="#player-slots" 
                 hx-swap="outerHTML">
                <!-- Player 1 Slot -->
                <div class="player-slot">
                    <h3>Player 1</h3>
                    {% if p1_exists %}
                        {% for player in players %}
                            {% if player.player_number == 1 %}
                                <button type="button" class="btn" style="background: {{ player.color }}; cursor: default;">
                                    {{ player.name }} Joined
                                </button>
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        <button type="submit" name="player_number" value="1" class="btn">
                            Join as Player 1
                        </button>
                    {% endif %}
                </div>

                <!-- Player 2 Slot -->
                <div class="player-slot">
                    <h3>Player 2</h3>
                    {% if p2_exists %}
                        {% for player in players %}
                            {% if player.player_number == 2 %}
                                <button type="button" class="btn" style="background: {{ player.color }}; cursor: default;">
                                    {{ player.name }} Joined
                                </button>
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        <button type="submit" name="player_number" value="2" class="btn">
                            Join as Player 2
                        </button>
                    {% endif %}
                </div>
            </div>
        </form>

    </div>

    <div id="start-game-container" 
         class="mt-5 text-center"
         hx-get="." 
         hx-trigger="every 7s" 
         hx-select="#start-game-container" 
         hx-swap="outerHTML">
        {% if players.count >= MIN_PLAYERS %}
            <a href="{% url 'game' %}" class="btn" style="font-size: 1.5rem; padding: 1rem 3rem; border-radius: 50px; font-weight: bold; text-transform: uppercase; letter-spacing: 2px;">Start Game</a>
        {% else %}
            <button class="btn btn-secondary" style="font-size: 1.5rem; padding: 1rem 3rem; border-radius: 50px; font-weight: bold; text-transform: uppercase; letter-spacing: 2px;" disabled>
                Waiting for Players...
            </button>
        {% endif %}
    </div>
{% endblock %}